
#论文一种性浏览器能自动化测试平台


##摘要
现在， 智能手机越来越普遍了，智能手机从传统的一种简单的人与人之间的通信工具变成了一种多用途设备。随着安卓只能手机的到来，使用智能手机访问互联网的人的数量将会高速增长。因此手机浏览器在为用户提供良好的浏览体验中扮演了重要的角色。
本文的目标是分析安卓平台上几个主要的手机浏览器的性能。在本文中，展示了几个常见和手机功能相关的参数测试后的结果。通过这个测试，可以发现浏览器最大的不足和缺陷用以提升用户体验。
目前Web浏览器再手持设备上(例如智能手机)可算是一个杀手级的应用了。可惜的是，在手机上web浏览器的体验却不是那么令人满意。尤其是页面加载时间较长， 缓存机制被认为是一个关键性因素。但是， 现有的被动评估研究并不能完成的定义Web Cache的表现。例如很多研究都是放在客户端的实现而不是服务端的配置。而用户的行为非常难以预料，因此很难研究没有被缓存的资源。本文着重强调了这个问题。提出了一个主动型的来全面评估web cache表现的方法。这个方案的关键思想是在一定周期时间内主动的爬下数以百计网站的资源。这样我们就可以发现网站的资源更新历史并且知道网站服务端的Cache配置。


关键字：安卓，浏览器，性能

##ABSTRACT
Nowadays, smart phones are fast becoming ubiquitous. They have evolved from their traditional use of solely being a device for communication between people to a multipurpose device. With the advent of Android smart phones, the number of people accessing the Internet through their mobile phones is on a steep rise. Hence, web browsers play a major role in providing an excellent browsing experience for its users. As such, the objective of this paper is to analyse the performance of five major mobile web browsers available in the android platform. In this paper, we present the results of a study conducted based on several parameters that assess these mobile browsers’ functionalities. Based on this evaluation, we also propose the best among these browsers to further enrich user experience of mobile web browsing along with utmost performance.

Keywords
Android, Browsers, Performance, Mobile, Dolphin, Mozilla Firefox, Skyfire, Opera Mini


#第一章 绪论


##1.1课题背景和来源

手机浏览器是运行在手机上的浏览器，可以通过GPRS进行上网浏览互联网内容。手机浏览器是一种用户在手机终端上通过无线通讯网络进行互联网内容浏览的移动互联网工具，其最主要的应用为网页浏览，同时也可以聚集大量的应用，如导航、社区、多媒体影音、天气、股市等，为用户提供全方位的移动互联网服务。
近年来，我国移动互联网发展势头迅猛，手机浏览器战略地位凸显，众多实力雄厚的互联网企业纷纷加大在手机浏览器市场的布局，投入大量的资金和人力，抢占手机浏览器用户入口。
从手机浏览器市场的发展阶段来看，2009年，中国手机浏览器市场处于市场探索初期，手机浏览器厂商通常采用面向用户免费的策略，以此抢占用户市场。该阶段手机浏览器的产业价值链比较短，主要包括开发、运营和用户，并未涉及大量的广告和内容。虽然手机浏览器已成为炙手可热的概念，但手机自带浏览器仍占据一半的移动互联网用户市场。用户下载安装的浏览器，依然有很大的发展空间。
2010-2011年，较具实力的手机浏览器厂商如手机QQ浏览器等纷纷夯实手机浏览器市场的竞争力，而百度、谷歌等厂商也陆续进入手机浏览器市场。手机浏览器市场“预装收取服务费、广告收费、用户使用或增值业务收费”的商业模式将逐步形成。随着手机浏览器用户粘性逐步养成，用户规模将趋于稳定，保守估计，2012年我国第三方手机浏览器活跃用户规模将达3.6亿户。
展望未来，随着三网融合进程的不断推进，广电网、电信网和互联网的网络融合将使手机发展成为具备看电视、语音通信以及网络服务的全能终端，手机浏览器作为手机端重要网络入口的战略地位将进一步提升。同时，国家层面正积极推动物联网发展，未来将有更多具备上网功能的终端出现，跨媒体网络融合的趋势将使手机浏览器获得更多的发展空间。
从技术层面来看，当前手机浏览器市场处于优化用户体验、引导用户需求阶段，长远来看，满足个性化的用户需求将最终成为指导应用软件发展的唯一标准。3G/4G网络的发展将大幅度改善数据传输的速度，是移动互联网实现快速发展的条件，也是“云计算”得以实现的前提。而“云计算”的实现将解除手机终端对用户的束缚，手机应用，尤其是个性化应用将出现爆发式增长，手机浏览器将成为沟通用户与“云”端服务器的重要渠道，手机浏览器的战略地位将无可替代。

2015年，移动端互联网应用超PC端已是不争事实，作为移动终端上网入口——手机浏览器，成为各大互联网公司争相抢夺的必争之地。在这样的行业背景下，究竟是哪一款浏览器能够给用户带来更好的浏览体验呢?此次将选取此领域的知名主流产品做一系列评估，希望能够成为用户选择手机浏览器时的参考。


最近几年， 使用手机浏览网页的用户正在爆发性增长。随着手机智能化的到来，移动端浏览用户的增加是由于市面上有了越来越多的完整功能移动浏览器。 2011年手机销量出现了显著增长。在IDC主导的一个调查中， 2011年全年出货的手机中， 有31.8%是智能手机。现代典型的智能手机一般都有较高解析度的触摸屏幕和一个能够呈现标准网页的浏览器,而不仅仅是智能渲染针对移动端优化过的网页。同时还具备通过Wi-Fi或3G4G高速访问网络的能力，根据SataCounter的报告，在2012年1月，8.49%的网页访问来自于移动设备。

移动端浏览器在用户浏览网页时扮演了一个重要角色，由于移动网络访问越来越重要，对于用户来说， 能否在众多浏览器中选择出一个能够给他带来流畅理想体验的浏览器就非常重要。更进一步说， 更好的浏览体验还取决于硬件和软件平台，用户友好的GUI，对新标准的支持和更好的扩展性，从这个角度来说，对于特定的使用场景，不同的浏览器会有不同的结果。

安卓是一个由Google发起的智能手机平台，开放手持设备联盟发表在2007年11月12号发表了Google Android SDK，在其出现的五年后，安卓目前是移动操作系统的领导者，并在在2010-2011年期间仍有244%的增长。一个由Canalys所作的调查显示在2011年，新出货的智能手机有48.8%采用的是安卓操作系统。[[1]](Global%20mobile%20statistics%202012:%20all%20quality%20mobile%20marketing%20research,%20mobile%20Web%20stats,%20ad%20revenue,usage,trends,%20http://mobithinking.com/mobile-marketing-%20tools/latest-mobile-stats%20Last%20accessed%20on%208th%20April%202012)

安卓是开放框架的平台，它又各种不同的开发和调试工具，各种图形处理库，多媒体的支持，当然还有一个强大的浏览器。在安卓中默认浏览器是建立在Webkit引擎之上的，尽管默认的浏览器已经可以满足日常浏览需要，但是如果想要拥有完整的浏览体验，还是有必要去体验其它浏览器的。

目前在安卓市场上有很多选择，有些是我们很熟悉的PC商店的浏览器，Chrome，Firefox， Opera。尽管看起来好像选择面很广，实际上只有为数不多的浏览器被广泛使用，因此我们只关注在安卓平台流行的几个浏览器上，他们是 Firefox，Chrome，Opera，QQ，UC，Android Browser。我们只是列举了在安卓市场上占有率前几名的浏览器。


市场上移动端手机的使用场景越来越丰富，功能上也正在接近于桌面浏览器。



##1.2课题的目的和意义


##1.3国内外研究现状
Google提供的Android SDK中，给出了三种方式可用于自动化测试，即Monkey、
MonkeyRunner和Instrumentation。其中，Monkey是一个随机压力测试工具。
Android市场上的大多数应用都是基于GUI的，Monkey通过向系统发送伪随机的用户事件流（如按键输入、触摸屏输入、手势输入等），对应用程序进行压力测试[7]。由于Monkey测试使用的事件流数据流是随机的，不能进行自定义，因此Monkey不符合可控测试的要求，但我们可以借鉴其发送事件的测试方式[8]。MonkeyRunner是由Python编写的测试工具，可以通过编写Python代码调用Android的API，从而达到自动化测试的目的。

例如，可以通过MonkeyRunner编写Python程序用于安装一个Android应用或测试包、运行测试、发送模拟事件、截取用户界面图片并存储到工作空间等等[9]。Instrumentation可理解为一种没有图形界面的、具有启动能力、用于监控其他类的工具类[10]。应用程序运行时，如果Instrumentation设置为开启状态，Instrumentation将在应用程序运行前进行初始化，与应用程序处在同一进程中，监测应用程序与系统之间的交互并对应用程序进行一定的控制[11]。然而，Instrumentation框架对测试人员的代码编写能力较高，开发成本较高。

前比较主流的Android自动化测试框架有：Activity Instrumentation，Robotium，Android  Native  Driver，Robolectric以及TMTS等。Activity  Instrumentation是Android自带的测试框架；Robotium是世界领先的Android自动化测试框架[12]，由国外团队研发，主要用于Android应用的黑盒自动化测试，Roboitum支持Activity，Dialog，Toast，Menu等，同时它能够跨Android的多个Actvity进行测试。最新发布的Robotium  4.1已支持对WebView的操作。Robotium是目前使用最广泛的框架之一。TMTS是由淘宝自动化测试团队针对自身产品开发的一套手机自动化测试框架，支持WebView的操作前比较主流的Android自动化测试框架有：Activity Instrumentation，Robotium，Android  Native  Driver，Robolectric以及TMTS等。
Activity  Instrumentation是Android自带的测试框架；Robotium是世界领先的Android自动化测试框架[12]，由国外团队研发，主要用于Android应用的黑盒自动化测试，Roboitum支持Activity，Dialog，Toast，Menu等，同时它能够跨Android的多个Actvity进行测试。最新发布的Robotium  4.1已支持对WebView的操作。Robotium是目前使用最广泛的框架之一。TMTS是由淘宝自动化测试团队针对自身产品开发的一套手机自动化测试框架，支持WebView的操作


Yu-Doo Kim 和 Il-Young Moon 在2013年提出了一种在测试智能手机上测试执行速度的方案[[参考文献]](Performance%20Analysis%20of%20Web-browsing%20Speed%20in%20Smart%20Mobile%20Devices)。大多数的web站点都是针对与PC机型。针对PC机型的测试可能对移动设备并不是那么有代表性，反而会造成一定的误导。他们的做法是先列出了所有测试浏览器性能的用例， 然后排出专门针对于桌面浏览器的例子。在得到的针对平板电脑，桌面PC和手持移动设别


PhantomCSS来测试css兼容性(不可靠)


##1.3本文研究主要内容
本人在XX公司实习期间， 曾负责浏览器性能自动化测试的工作。在已有的前端测试用例基础上，经过实践开了适合项目的浏览器自动化测试平台。这个浏览器性能测试平台实现了定时自动测试，测试用例管理，测试用例自动执行和测试结果报告的功能， 为项目组的浏览器自动化测试开发提供了一个可行的工程方案。
主要研究工作有： 对相关需求文档进行分析，在已有的测试用例基础上，设计合理的浏览器性能评估自动化测试用例。结合目前前端工程实际情况， 进行自动化测试框架选型， 利用尾触发异步流程解决方案实现异步执行流程控制。使用MongoDB进行数据存储，以及国内新颖的Echarts做数据中展示。综合上述工作，实现了一个测试用例驱动的浏览器性能测试框架， 使用基于浏览器API实现了浏览器性能黑盒测试。
在本篇论文中， 主要目标提出一个浏览器性能评估体系，并且实现一个完整的平台来测试上面提到的几个安卓平台的主流浏览器。浏览器性能评价维度将放在第三章， 测试平台的实现将放在第四章。建立在上面测试案例基础上的测试结果将放在第五章，并给出结果。

#第二章 关键技术分析
##2.1HTML5技术分析与研究
###2.1.1 HTML5概述
##2.2非关系型数据库
###2.2.1 NoSql
###2.2.2 一个应用较为广泛的的非关系型数据库 MongoDB
##2.3本地存储
###2.3.1HTTP1.1的缓存
###2.3.2HTML5 WebStorage
###2.3.3App Cache
##2.4NodeJS
###2.4.1 NodeJS与服务器
###2.4.2 NodeJS与Android



#第三章 系统需求分析与设计
##3.1测试用例设计
###3.1.1浏览器性能测试指标
###3.1.2测试用例框架设计
###3.1.3DOM测试用例
###3.1.4Cache测试用例
###3.1.5CSS兼容性测试用例设计
##3.2异步处理
###3.2.1 过多嵌套导致的问题
###3.2.2 Promise A+ Async  （两种应用广泛的异步处理方式）
###3.2.3 Flow
##3.3数据库设计
##3.4模块化处理
###3.4.1模块化原理
###3.4.2AMD 和 CMD  （两种应用广泛的模块化介绍）
##3.5浏览器选择
最有效分类浏览器的做法就是把浏览器分成两大类，传统，全功能的浏览器；另一种就是轻巧的迷你浏览器。完整功能的浏览器倾向于带来更接近于桌面浏览器移动端体验，他们的迷你版本更注重性能和向后的兼容性。本论文主要关注几个全功能移动浏览器和一个迷你浏览器。因此根据下面两个考虑选择了5个安卓平台的浏览器，浏览器的市场占有率和流行程度，这些数据来自于 [[6]](Mobile/Tablet%20Browser%20Market%20Share%20http://netmarketshare.com/browser-market-%20share.aspx?qprid=0&qpcustomd=1%20Last%20accessed%20on%2028th%20March%202012). 因此选择了默认浏览器，Firefox，Chrome， Opera。这些浏览器的版本如下表， 他们均是当前最新版本。

#第四章 测试平台实现
##4.1详细用例实现
##4.2异步问题解决
##4.3数据库处理
##4.4移动端前端问题和解决
##4.5定时任务
##4.6Android 唤起应用

#第五章 总结与展望
##5.1总结
##5.2展望










